@page
@model WebAppToys.Pages.Admin.Listings.IndexModel
@using Infrastructure.Utility
@using System.Security.Claims;

@{
    ViewData["Title"] = "Listings";
}

<div class="container p-3 col-6">
    <div class="card bg-transparent shadow border-0">
        <div class="card-body semi-transparent">
            <div class="row">
                <div class="col-6">
                    <h2 class="text-primary">Toy List</h2>
                </div>
                <div class="col-6 text-end">
                    @if (User.IsInRole(SD.UserRole))
                    {
                        <a asp-page="Upsert" asp-route-id="0" class="btn btn-primary">
                            <i class="fas fa-plus-circle"></i>&nbsp;Create New
                        </a>
                    }
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-6">
                    <a asp-page="./Index" asp-route-ShowMyListings="@(Model.ShowMyListings ? "false" : "true")" class="btn btn-outline-primary">
                        @(Model.ShowMyListings ? "Show All Listings" : "Show My Listings")
                    </a>
                </div>
            </div>
            <br>
        </div>
    </div>
</div>
<div class="container p-3 col-6">
    <div class="card bg-transparent shadow border-0">
        <div class="card-body semi-transparent">
            <div class="table-responsive">
                <table id="" class="table " style="width:100%;">
                    <thead class="">
                        <tr>
                            <th class="text-center">
                                Toys
                            </th>
                            
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var toy in Model.ListingObj)
                        {
                            <tr>
                                <td class="align-middle">
                                    @toy.Name
                                </td>
                                <td>
                                    <div class="d-flex justify-content-end ">
                                        
                                        <a asp-page="./Details" asp-route-id="@toy.Id"
                                           class="btn btn-primary text-white" style="cursor: pointer; margin-right: 5px; white-space: nowrap;">
                                            View Details
                                        </a>
                                        
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>











        @section Scripts{
            @if (User.IsInRole(SD.UserRole) || User.IsInRole(SD.AdminRole))
            {

                <script>
            $(document).ready(function () {
                    var filter = $('#toggle-filter');
                    var dataTable = $('#DT_load').DataTable();
                    var userId = '@User.FindFirstValue(ClaimTypes.NameIdentifier)';
                    var filterOn = false;
                    filter.click(function () {
                        filterOn = !filterOn;
                        if (filterOn) {
                            dataTable.columns(1).search(userId).draw();
                            filter.html("Show All Listings");
                        } else {
                            dataTable.columns(1).search('').draw();
                            filter.html("Show My Listings");
                        }
                    });
                });
                </script>
                <script>function Delete(url) {
                        swal({
                            title: "Are you sure you want to delete this item?",
                            text: "You will not be able to restore this data!",
                            icon: "warning",
                            buttons: [true, "Confirm Delete"], // multiple buttons e.g. cancel and ok buttons
                            dangerMode: [true] // sets the default focus on the cancel button, so you don't accidentally delete something, etc.
                        }).then((willDelete) => {
                            if (willDelete) {
                                $.ajax({
                                    type: 'DELETE',
                                    url: url,
                                    success: function (data) {
                                        if (data.success) {
                                            toastr.success(data.message);

                                        }
                                        else
                                            toastr.error(data.message);


                                    }
                                })
                            }
                        })</script>
            }
        }
